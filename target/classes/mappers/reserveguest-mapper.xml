<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ReserveGuest">
	<resultMap type="ReserveGuest" id="ReserveGuestMap">
		<id property="reserveGuestCode" column="reserve_guest_code"/>
		<result property="userCode" column="user_code"/>
		<result property="roomType" column="room_type"/>
		<result property="roomCode" column="room_code"/>
		<result property="startTime" column="start_time"/>
		<result property="endTIme" column="end_time"/>
		<result property="regiDate" column="regi_date"/>
		<result property="status" column="status"/>
	</resultMap>
	
	<!-- 게스트하우스 예약 테이블 -->

    <!-- 예약 가능 여부 조회 -->
    <select id="checkRoom" parameterType="map" resultType="map">
         <![CDATA[
        SELECT room_code, room_type
        FROM reserve_guest
        WHERE room_type = #{roomType}
        AND room_code IN (
            SELECT room_code 
            FROM reserve_guest 
            WHERE room_type = #{roomType} 
            AND (
            (#{startTime} < start_time AND #{endTime} > start_time) OR
            (#{startTime} = start_time AND #{endTime} < end_time) OR
            (#{startTime} = start_time AND #{endTime} = end_time) OR
            (#{startTime} > start_time AND #{startTime} < end_time AND #{endTime} = end_time)
            )
        )
        ]]>
    </select>


	<!-- 게스트하우스 예약 등록 -->
	<insert id="registerGuestReserve" parameterType="ReserveGuest" useGeneratedKeys="true" keyProperty="reserveGuestCode" keyColumn="reserveGuestCode">
		INSERT INTO reserve_guest(user_code, room_type, room_code, start_time, end_time) 
		VALUES(#{userCode}, #{roomType}, #{roomCode}, #{startTime}, #{endTime})
	</insert>

</mapper>