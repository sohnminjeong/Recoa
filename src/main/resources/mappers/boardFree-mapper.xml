<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boardFreeMapper">
	<resultMap type="BoardFree" id="boardFreeMap">
		<id property="freeCode" column="free_code"/>
		<result property="userCode" column="user_code"/>	
		<result property="freeTitle" column="free_title"/>	
		<result property="freeContent" column="free_content"/>
		<result property="freeWritedate" column="free_writedate"/>
		<result property="freeView" column="free_view"/>
		<result property="freeLike" column="free_like"/>
		<collection property="user" resultMap="userMap"/>
	</resultMap>
	
	<resultMap type="User" id="userMap">
		<id property="userCode" column="user_code"/>
		<result property="userNickname" column="user_nickname"/>	
	</resultMap>
	
	<!-- 게시물 작성 -->
	<insert id="registerBoardFree" parameterType="BoardFree" useGeneratedKeys="true" keyColumn="free_code" keyProperty="freeCode">
	INSERT INTO board_free(user_code, free_title, free_content)
	VALUES(#{userCode}, #{freeTitle}, #{freeContent})
	</insert>
	
	<!-- 게시물 전체보기 -->
	<select id="listBoardFree" parameterType="BoardFreePaging" resultMap="boardFreeMap">
	SELECT A.user_code, A.free_title, A.free_content, B.user_nickname, A.free_writedate 
	FROM board_free as A 
	JOIN user as B 
	USING(user_code)
	<where>
		<choose>
			<when test="select=='allFind'">
				free_title LIKE CONCAT('%', #{keyword}, '%')
				OR free_content LIKE CONCAT('%', #{keyword}, '%')
			</when>
			<when test="select=='titleFind'">
				free_title LIKE CONCAT('%', #{keyword}, '%')
			</when>
			<when test="select=='contentFind'">
				free_content LIKE CONCAT('%', #{keyword}, '%')
			</when>
		</choose>
	</where>
	ORDER BY A.free_writedate DESC
	LIMIT #{offset}, #{limit}
	</select>
	
	<select id="countBoardFree" parameterType="BoardFreePaging" resultType="int">
	SELECT count(*) FROM board_free
	<where>
		<choose>
			<when test="select=='allFind'">
				free_title LIKE CONCAT('%', #{keyword}, '%')
				OR free_content LIKE CONCAT('%', #{keyword}, '%')
			</when>
			<when test="select=='titleFind'">
				free_title LIKE CONCAT('%', #{keyword}, '%')
			</when>
			<when test="select=='contentFind'">
				free_content LIKE CONCAT('%', #{keyword}, '%')
			</when>
		</choose>
	</where>
	</select>
</mapper>