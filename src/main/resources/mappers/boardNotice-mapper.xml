<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BoardNotice">
	<resultMap type="BoardNotice" id="BoardNoticeMap">
		<id property="noticeCode" column="notice_code"/>
		<result property="userCode" column="user_code"/>	
		<result property="noticeTitle" column="notice_title"/>	
		<result property="noticeContent" column="notice_content"/>
		<result property="noticeWritedate" column="notice_writedate"/>
		<result property="noticeView" column="notice_view"/>
	</resultMap>
	
	<resultMap type="User" id="userMap">
		<id property="userCode" column="user_code"/>
		<result property="userId" column="user_id"/>
		<result property="userRealName" column="user_name"/>
		<result property="userNickname" column="user_nickname"/>	
		<result property="userImgUrl" column="user_img_url"/>
		<result property="userPhone" column="user_phone"/>
		<result property="userAdr" column="user_adr"/>
		<result property="userAdrDetail" column="user_adr_detail"/>
		<result property="userEmail" column="user_email"/>
		<result property="userAdmin" column="user_admin"/>	
	</resultMap>
	
	<!-- 공지 작성 -->
	<insert id="registerNotice" parameterType="boardNotice" useGeneratedKeys="true" keyProperty="noticeCode" keyColumn="noticeCode">
		INSERT INTO board_notice(user_code, notice_title, notice_content)
		VALUES(#{userCode}, #{noticeTitle}, #{noticeContent})
	</insert>
	
	<!-- 공지 리스트 -->
	<select id="noticeList" parameterType="BoardNoticePaging" resultMap="BoardNoticeMap">
		SELECT *
		FROM board_notice
		<where>
			<choose>
				<when test="select=='all'">
					notice_title LIKE CONCAT('%', #{keyword}, '%')
					OR notice_content LIKE CONCAT('%', #{keyword}, '%')
				</when>
				<when test="select=='title'">
					notice_title LIKE CONCAT('%', #{keyword}, '%')
				</when>
				<when test="select=='content'">
					notice_content LIKE CONCAT('%', #{keyword}, '%')
				</when>
			</choose>
		</where>
		ORDER BY notice_code DESC
		LIMIT #{offset}, #{limit}
	</select>
	
	<!-- 공지 리스트 total -->
	<select id="noticeListTotal" parameterType="BoardNoticePaging" resultType="int">
		SELECT count(*) FROM board_notice
		<where>
			<choose>
				<when test="select == 'all'">
					notice_title LIKE CONCAT('%',#{keyword},'%') 
				OR notice_content LIKE CONCAT('%',#{keyword},'%')
				</when>
				<when test="select == 'title'">
					notice_title LIKE CONCAT('%',#{keyword},'%')
				</when>
				<when test="select == 'content'">
					notice_content LIKE CONCAT('%',#{keyword},'%')
				</when>
			</choose>
		</where>
	</select>
	
	<!-- 공지 하나 보기 -->
	<select  id="noticeOne" parameterType="int" resultMap="BoardNoticeMap">
		SELECT *
		FROM board_notice
		JOIN user
		USING (user_code)
		WHERE notice_code=#{noticeCode}
	</select>
	
	<!-- 공지 조회수 증가 -->
	<update id="addViewCount" parameterType="int">
		UPDATE board_notice
		SET notice_view = notice_view + 1
		WHERE notice_code = #{noticeCode}
	</update>
	
	<!-- 삭제 -->
	<delete id="deleteNotice" parameterType="int">
		DELETE FROM board_notice
		WHERE notice_code=#{noticeCode}
	</delete>
	
	<!-- id로 userCode 조회 -->
	<select id="findUserCode" parameterType="String" resultType="int">
		SELECT user_code
		FROM user
		WHERE user_id = #{userId}
	</select>
</mapper>